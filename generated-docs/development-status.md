Last updated: 2025-12-02

# Development Status

## 現在のIssues
- [Issue #33](../issue-notes/33.md) は、`ym2151-tone-editor`が生成するGM000 variations format JSONファイルを、従来の`tones/`ディレクトリよりも優先して読み込む新しい仕様追加を検討しています。
- [Issue #22](../issue-notes/22.md) は、`ym2151-tone-editor`を利用して`tones/000.json`から`127.json`までのトーン定義ファイルを実際に作成し配置する手作業に関連しています。
- これらのタスクは、プロジェクトのYM2151音源定義の柔軟性と実用性を向上させ、外部ツールの連携を強化することを目的としています。

## 次の一手候補
1. `ym2151-tone-editor`出力JSONの優先読み込み機能の実装準備 [Issue #33](../issue-notes/33.md)
   - 最初の小さな一歩: プロジェクトに新しい設定オプションを追加し、指定されたディレクトリからトーン定義JSONファイルを読み込むための関数プロトタイプを`src/ym2151/tone.rs`に作成します。既存の`tones/`からの読み込み処理と共存できるように考慮します。
   - Agent実行プロンプト:
     ```
     対象ファイル: src/ym2151/tone.rs, src/ym2151/mod.rs

     実行内容: `src/ym2151/tone.rs`に、`load_tones_from_directory(path: &Path) -> Result<HashMap<u8, Tone>, io::Error>` のような関数プロトタイプを追加してください。この関数は指定されたパスからJSONファイルを読み込み、`Tone`構造体のHashMapとして返すことを想定します。また、`src/ym2151/mod.rs`でこの新しいトーン読み込みロジックを統合するための高レベルな関数やロジックの変更点を検討し、コメントとして記述してください。

     確認事項: 既存の`tones/`からのトーン読み込みロジックとの競合がないこと、およびRustの`std::path::Path`や`std::fs`モジュールを使ったファイル操作のベストプラクティスに従うことを確認してください。また、エラーハンドリング（ファイルが見つからない、JSONパースエラーなど）を考慮に入れてください。

     期待する出力: `src/ym2151/tone.rs`に新しい関数プロトタイプが追加されたコード変更、および新しいトーン読み込みロジックの統合に関するコメントが`src/ym2151/mod.rs`に追加されたコード変更。
     ```

2. `ym2151-tone-editor`が出力するGM000 variations format JSONの構造分析 [Issue #22](../issue-notes/22.md)
   - 最初の小さな一歩: 現在プロジェクトに存在する`tones/000.json`の内容と、GM000 variations formatの一般的な構造（想定される`ym2151-tone-editor`の出力）を比較し、YM2151のトーン定義がどのように表現されるかを分析します。
   - Agent実行プロンプト:
     ```
     対象ファイル: tones/000.json

     実行内容: `tones/000.json`の内容を分析し、それがYM2151のトーンイベントをどのように表現しているかをMarkdown形式で説明してください。特に、`addr`と`data`フィールドの意味、`events`配列の構造に焦点を当ててください。また、`ym2151-tone-editor`が出力するとされる「GM000 variations format json」が、現在の`tones/000.json`の構造とどのように異なる可能性があるかについて、一般的なGMフォーマットの知識に基づいた推測を交えて考察し、その差異がコードに与える影響について記述してください。

     確認事項: `tones/000.json`がYM2151のレジスタ設定に直接対応しているという前提で分析を進めてください。GM000 variations formatについては、具体的なファイルがないため、一般的な情報源から得られる知識に基づいて推測を行うことを認識してください。

     期待する出力: `tones/000.json`の構造分析と、GM000 variations formatとの予想される差異、およびその差異がトーン読み込みロジックに与える影響について記述されたMarkdownファイル。
     ```

3. 複数のトーンソースからの読み込みをサポートするためのリファクタリング検討 [Issue #33](../issue-notes/33.md)
   - 最初の小さな一歩: 既存のトーン読み込みロジック（`src/ym2151/tone.rs`や`src/ym2151/init.rs`あたりにあると想定される）が、将来的に複数のソース（例: `tones/`と`ym2151-editor-tones/`）からのトーンをどのように効率的かつクリーンに管理できるか、現在の構造を分析し、改善案を検討します。
   - Agent実行プロンプト:
     ```
     対象ファイル: src/ym2151/tone.rs, src/ym2151/init.rs, src/ym2151/mod.rs

     実行内容: 現在のプロジェクトにおけるトーン定義の読み込みと管理に関するロジックを分析してください。特に、`Tone`構造体の定義、トーンデータのパース方法、そしてそれらがアプリケーション全体でどのように利用されているかを確認してください。そして、[Issue #33](../issue-notes/33.md) で提案されている「`ym2151-tone-editor`の出力するGM000 variations format jsonを優先して読み込む」という要件を満たすために、既存のトーン読み込みロジックをどのようにリファクタリングできるか、具体的なクラス/関数設計の提案を含めてMarkdown形式で記述してください。複数のソースからのトーンを優先度付きでマージするメカニズムに焦点を当ててください。

     確認事項: 既存のロジックが変更されることによる影響範囲を最小限に抑えつつ、拡張性を高める設計を検討してください。`HashMap`や`Vec`のような標準コレクションを利用した効率的なデータ管理方法を考慮してください。

     期待する出力: 現在のトーン読み込みロジックの分析結果、および複数のトーンソースを優先度付きで管理・読み込むための具体的なリファクタリング案が記述されたMarkdownファイル。
     ```

---
Generated at: 2025-12-02 07:07:26 JST
