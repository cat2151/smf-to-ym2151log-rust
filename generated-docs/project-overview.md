Last updated: 2026-01-21

# Project Overview

## プロジェクト概要
- Standard MIDI Files (SMF) をYM2151 FM音源チップのレジスタ書き込みログに変換するRustツールです。
- 複雑なチャンネル割り当て戦略と2パス処理アーキテクチャで、高品質なYM2151出力を生成します。
- カスタムYM2151音色に対応し、他のRustプロジェクトからライブラリとしても利用可能です。

## 技術スタック
- フロントエンド: このプロジェクトはコマンドラインツールであり、直接的なフロントエンド技術は使用していません。
- 音楽・オーディオ:
    - **YM2151 FM音源チップ**: 変換後のターゲットとなるヤマハ製のFM音源チップ。そのレジスタ操作をJSON形式で出力します。
    - **Standard MIDI Files (SMF)**: プロジェクトの入力となる標準MIDIファイル形式（Format 0および1をサポート）です。
- 開発ツール:
    - **Rust**: 高パフォーマンスと型安全性を特徴とするシステムプログラミング言語で、このプロジェクトの主要な実装言語です。
    - **Cargo**: Rustの公式ビルドシステムおよびパッケージマネージャーで、プロジェクトのビルド、テスト、依存関係管理に使用されます。
    - **Git**: ソースコードのバージョン管理システムです。
- テスト:
    - **`cargo test`**: Rustプロジェクトのユニットテストおよび統合テストを実行するためのコマンドです。
    - **`cargo tarpaulin`**: Rustプロジェクトのテストカバレッジを測定し、レポートを生成するツールです。
- ビルドツール:
    - **Cargo**: Rustのビルドシステムとして、プロジェクトのコンパイルと実行可能ファイルの生成を管理します。
- 言語機能:
    - **Rustの型安全性**: コンパイル時に多くのエラーを捕捉し、堅牢なコードを保証します。
    - **Rustの高パフォーマンス**: ネイティブコードにコンパイルされるため、高速な処理が可能です。
- 自動化・CI/CD: 明示的なCI/CDツールに関する情報はありません。
- 開発標準:
    - **`cargo fmt`**: Rustコードのスタイルを自動的にフォーマットし、コードの一貫性を保ちます。
    - **`cargo clippy`**: Rustコードの一般的な間違いや非効率なパターンを検出するLintツールです。
    - **`cargo audit`**: プロジェクトの依存関係に既知のセキュリティ脆弱性がないかをチェックします。

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.ja.md
📖 README.md
📄 _config.yml
📁 generated-docs/
🌐 googled947dc864c270e07.html
📁 issue-notes/
  📖 21.md
  📖 22.md
  📖 23.md
  📖 25.md
  📖 28.md
  📖 30.md
  📖 32.md
  📖 33.md
  📖 34.md
  📖 36.md
  📖 38.md
  📖 39.md
  📖 41.md
  📖 43.md
  📖 45.md
  📖 47.md
📁 src/
  📄 error.rs
  📄 lib.rs
  📄 main.rs
  📁 midi/
    📄 events.rs
    📄 mod.rs
    📄 parser.rs
    📄 utils.rs
  📁 ym2151/
    📄 channel_allocation.rs
    📄 converter.rs
    📄 converter_tests.rs
    📄 event_processor.rs
    📄 events.rs
    📄 init.rs
    📄 mod.rs
    📄 note_table.rs
    📄 tempo_map.rs
    📄 tone.rs
📁 tests/
  📄 create_test_midi.py
  📄 integration_tests.rs
  📁 test_data/
    📄 multi_channel.mid
    📄 multi_track.mid
    📄 program_change.mid
    📄 simple_melody.mid
    📄 tempo_change.mid
📁 tones/
  📊 000.json
  📖 README.md
```

## ファイル詳細説明
- **`.gitignore`**: Gitがバージョン管理の対象としないファイルやディレクトリを指定します。
- **`Cargo.lock`**: Cargoがプロジェクトの依存関係を解決した際の具体的なバージョン情報を記録し、ビルドの再現性を保証します。
- **`Cargo.toml`**: Rustプロジェクトのマニフェストファイル。プロジェクト名、バージョン、依存クレート、ビルド設定などを定義します。
- **`LICENSE`**: プロジェクトの配布および使用に関するライセンス情報を提供します。
- **`README.ja.md`**: プロジェクトの目的、機能、使い方などを日本語で説明する主要なドキュメントです。
- **`README.md`**: プロジェクトの目的、機能、使い方などを英語で説明する主要なドキュメントです。
- **`_config.yml`**: GitHub Pagesなどの静的サイトジェネレーターの設定ファイルです。
- **`generated-docs/`**: `cargo doc` コマンドで生成されるAPIドキュメントなどの成果物を格納するディレクトリです。
- **`googled947dc864c270e07.html`**: Googleサービスにおけるサイトの所有権確認に使用されるファイルです。
- **`issue-notes/`**: 開発中の課題や検討事項に関するメモがMarkdown形式で保存されています。
- **`src/error.rs`**: アプリケーション全体で発生しうるカスタムエラー型を定義し、エラーハンドリングを一元化します。
- **`src/lib.rs`**: このプロジェクトがライブラリとして提供するパブリックAPIのエントリポイントです。主要な変換ロジックやデータ構造が含まれます。
- **`src/main.rs`**: コマンドラインツールとしてのアプリケーションのエントリポイントです。`lib.rs` の機能を利用してMIDIファイルのパースとYM2151ログへの変換処理を実行します。
- **`src/midi/events.rs`**: Standard MIDI File内の様々なイベント（NoteOn, NoteOff, TempoChangeなど）を表現するためのデータ構造と関連ロジックを定義します。
- **`src/midi/mod.rs`**: `src/midi` モジュールのルートファイルであり、このディレクトリ内のサブモジュールを公開します。
- **`src/midi/parser.rs`**: Standard MIDI Fileのバイナリデータを読み込み、内部的なMIDIイベントのシーケンスに変換するパーシングロジックを実装しています。
- **`src/midi/utils.rs`**: MIDIイベント処理やパーシングを補助するユーティリティ関数やヘルパー関数を提供します。
- **`src/ym2151/channel_allocation.rs`**: MIDIチャンネルからのノートイベントをYM2151の限られた8つのFMチャンネルに割り当てるための複雑な戦略（和音数ベース、ドラム優先など）を実装しています。
- **`src/ym2151/converter.rs`**: 中間MIDIイベントから最終的なYM2151レジスタ書き込みログへの変換処理を統合する主要なモジュールです。
- **`src/ym2151/converter_tests.rs`**: `src/ym2151/converter.rs` で実装された変換ロジックの単体テストを定義しています。
- **`src/ym2151/event_processor.rs`**: YM2151のレジスタイベントをタイムラインに沿って処理し、チップの状態を管理するロジックを実装しています。
- **`src/ym2151/events.rs`**: YM2151のレジスタ書き込みを表現するデータ構造と、それらをJSON形式で出力するためのシリアライゼーションロジックを定義しています。
- **`src/ym2151/init.rs`**: YM2151チップが起動時に必要な初期設定レジスタの値を定義しています。
- **`src/ym2151/mod.rs`**: `src/ym2151` モジュールのルートファイルであり、このディレクトリ内のサブモジュールを公開します。
- **`src/ym2151/note_table.rs`**: MIDIノート番号とYM2151チップが認識する周波数パラメータ（Key Code, Fraction）間のマッピングを管理するテーブルと関連ロジックを定義しています。
- **`src/ym2151/tempo_map.rs`**: MIDIファイル内のテンポ変更イベントを解析し、MIDIティックと実時間（秒）間の変換マップを構築・管理するロジックを実装しています。
- **`src/ym2151/tone.rs`**: YM2151の音色データ構造を定義し、プログラムチェンジによって読み込まれるカスタム音色ファイルの処理ロジックを扱います。
- **`tests/create_test_midi.py`**: 統合テストで使用されるサンプルMIDIファイルをプログラム的に生成するためのPythonスクリプトです。
- **`tests/integration_tests.rs`**: プロジェクトの主要な機能が連携して正しく動作するかを検証する統合テストを定義しています。
- **`tests/test_data/`**: 統合テストや機能デモンストレーションに使用される、様々な種類のサンプルMIDIファイル（複数チャンネル、プログラムチェンジ、テンポ変更など）を格納するディレクトリです。
- **`tones/000.json`**: MIDIプログラム0番（アコースティックグランドピアノ）に対応するYM2151カスタム音色の定義ファイルです。プログラムチェンジイベントによりロードされます。
- **`tones/README.md`**: `tones/` ディレクトリに配置するカスタムYM2151音色ファイルのJSONフォーマットと作成方法に関する説明です。

## 関数詳細説明
提供されたプロジェクト情報からは、Rustコード内の具体的な関数名、その引数、戻り値、詳細な機能を特定できません。したがって、個々の関数の詳細な説明は提供できません。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした

---
Generated at: 2026-01-21 07:09:36 JST
