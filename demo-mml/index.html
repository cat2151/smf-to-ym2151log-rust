<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MML Demo - SMF to YM2151</title>
</head>
<body>
    <h1>MML to YM2151 Demo</h1>
    <p>Convert MML (Music Macro Language) to YM2151 register logs using WebAssembly.</p>

    <div id="waveform-section" style="display: none;">
        <h2>Waveform Visualization</h2>
        <button id="play-audio-btn">‚ñ∂ Play Audio</button>
        <div id="waveform-container">
            <canvas id="waveform-canvas" width="800" height="200"></canvas>
        </div>
        <div id="play-overlay" class="play-overlay" style="display: none;">
            <button id="floating-play-btn" aria-label="Play audio">‚ñ∂ Play</button>
        </div>
    </div>

    <div class="info-box" id="setup-info">
        <h3>‚ÑπÔ∏è Local Development Setup</h3>
        <p>This section is for local development only. The deployed demo includes all required dependencies.</p>
        <details>
            <summary>Setup Instructions (for local development)</summary>
            <p>This demo requires the <code>mmlabc-to-smf-wasm</code> module from the <a href="https://github.com/cat2151/mmlabc-to-smf-rust" target="_blank">mmlabc-to-smf-rust</a> repository.</p>
            <ol>
                <li>Clone mmlabc-to-smf-rust repository</li>
                <li>Build WASM module: <code>cd mmlabc-to-smf-wasm && wasm-pack build --target web</code></li>
                <li>Build tree-sitter grammar: <code>cd tree-sitter-mml && npx tree-sitter build-wasm</code></li>
                <li>Copy the following files to this demo directory:
                    <ul>
                        <li><code>mmlabc-to-smf-wasm/pkg/</code> ‚Üí <code>./mmlabc-pkg/</code></li>
                        <li><code>tree-sitter-mml/tree-sitter-mml.wasm</code> ‚Üí <code>./public/</code></li>
                        <li><code>node_modules/web-tree-sitter/web-tree-sitter.wasm</code> ‚Üí <code>./public/</code></li>
                    </ul>
                </li>
            </ol>
            <p>See <a href="https://github.com/cat2151/mmlabc-to-smf-rust/blob/main/demo/README.md" target="_blank">demo/README.md</a> in mmlabc-to-smf-rust for detailed instructions.</p>
        </details>
    </div>
    
    <label for="mml-input">Enter MML code:</label>
    <textarea id="mml-input" placeholder="Enter MML code here, e.g., cdefgab"></textarea>
    
    <button id="convert-mml-button">Convert to YM2151</button>
    
    <div class="example-buttons">
        <p><strong>üìù MML Examples (click to try):</strong></p>
        <button class="example-button">Simple melody: cdefgab</button>
        <button class="example-button">With octave and length: o5 l4 cdefgab</button>
        <button class="example-button">C major chord: c;e;g</button>
        <button class="example-button">Twinkle Twinkle: o4 c c g g a a g2 f f e e d d c2</button>
    </div>

    <div id="output">
        <p>Enter MML code and click "Convert to YM2151" to see the output...</p>
    </div>

    <footer class="github-link">
        <a href="https://github.com/cat2151/smf-to-ym2151log-rust" target="_blank" rel="noopener noreferrer">GitHub</a>
        <span style="margin: 0 8px;">|</span>
        <a href="../">MIDI Demo</a>
        <span style="margin: 0 8px;">|</span>
        <a href="../demo-library/">Library Demo</a>
    </footer>

    <div id="rendering-overlay" class="rendering-overlay" style="display: none;">
        <div class="rendering-overlay__content" role="status" aria-live="polite" id="rendering-overlay-text">
            Rendering... UI is temporarily disabled.
        </div>
    </div>

    <script type="module" src="/mml-demo.ts"></script>
</body>
</html>
